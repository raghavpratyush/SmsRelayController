GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 1


   1               	# 1 "uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm"
   1               	;**************************************************************************************************
   0               	
   0               	
   2               	;                                               uC/OS-II
   3               	;                                         The Real-Time Kernel
   4               	;
   5               	;                                          AVR Specific code
   6               	;                                           (AVR-GCC 3.x)
   7               	;
   8               	;
   9               	; File         : OS_CPU_A.ASM
  10               	; By           : Ole Saether
  11               	; Port Version : V1.01
  12               	;
  13               	; AVR-GCC port version : 1.0 	2001-04-02 modified/ported to avr-gcc by Jesper Hansen (jesperh@telia
  14               	;
  15               	; Modifications by Julius Luukko 2003-02-19 (Julius.Luukko@lut.fi):
  16               	;
  17               	; - Minor modification to OSTickISR's declaration to global and addition of #include <avr/io.h> 
  18               	;   in order to work with gcc 3.3.
  19               	; - Moved 'sei' from the beginning of OSTickISR after the increasing of OSIntNesting (as the book s
  20               	; - Changed the order of reloading the timer counter and calling of OSIntExit
  21               	; - Changed OSIntCtxSw to the way it is supposed to be with OS_VERSION >= 251
  22               	; - Changed OSTickISR so that is saves the stack pointer into the current task's OS_TCB if OSTickIS
  23               	;   first level ISR
  24               	; - os_cfg.h must be included (definitions of CPU_CLOCK_HZ and OS_TICKS_PER_SEC)
  25               	; - avr/io.h is included to get SIG_OVERFLOW0 to produce the code to the interrupt vector table
  26               	;
  27               	; Modifications by Julius Luukko 2003-03-06 (Julius.Luukko@lut.fi):
  28               	;
  29               	; - RAMPZ is also saved to the stack
  30               	;
  31               	; Modifications by Julius Luukko 2003-03-18 (Julius.Luukko@lut.fi):
  32               	;
  33               	; - RAMPZ and SREG were popped out of the stack in the wrong order! Corrected this.
  34               	; - Divided macros PUSHRS and POPRS into to macros PUSHRS, PUSHSREG, POPRS and POPSREG. Additionall
  35               	; in ISRs macro called PUSHSREGISR must be used. It sets the I bit i SREG, since its always unset, 
  36               	; ISR is entered. It must be, however, set to enable interrupts when the task is run again.
  37               	; - RCALLs changed to CALLs. This allows the code of called functions to be further away from the c
  38               	;   (fixes the "relocating truncated to fit" error from the linker)
  39               	; 
  40               	;
  41               	; Modifications by Julius Luukko 2003-03-19 (Julius.Luukko@lut.fi):
  42               	;
  43               	; - timer interrupt is changed so that the timer counter register is updated right after _not_first
  44               	;   (was AFTER the call to OSIntExit!!)
  45               	;
  46               	; Modifications by Julius Luukko 2003-06-24 (Julius.Luukko@lut.fi):
  47               	;
  48               	; - I/O port addressing is now done using the macro _SFR_IO_ADDR from avr-libc and the address
  49               	; definitions are removed from here
  50               	; - RAMPZ is pushed and popped only if it is defined, i.e. with chips that have it
  51               	;
  52               	; Modifications by Julius Luukko 2003-07-21 (Julius.Luukko@lut.fi) for V2.70
  53               	;
  54               	; - OSTaskSwHook is not called if OS_TASK_SW_HOOK_EN == 0
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 2


  55               	; - defines typedef to ; so that os_cfg_r.h can be used more easily as a starting point for
  56               	;   the application specific os_cfg.h
  57               	;
  58               	; Modifications by Julius Luukko 2003-09-11 (Julius.Luukko@lut.fi)
  59               	;
  60               	; - now all subroutine calls use 'rcall' with devices with <= 8 kB of program memory.
  61               	;
  62               	;
  63               	; Modifications by Julius Luukko 2007-11-27 (Julius.Luukko@lut.fi)
  64               	;
  65               	; - r1 is cleared in OSTickISR before calling OSTimeTick (a function made in C)
  66               	;   (a bug discovered by Pavel HornÃ­cek)
  67               	;
  68               	;**************************************************************************************************
  69               	
  70               	;**************************************************************************************************
  71               	;                                      C PREPROCESSOR DIRECTIVES
  72               	;**************************************************************************************************
  73               	
  74               	#include <avr/io.h>
   1               	/* Copyright (c) 2002,2003,2005,2006,2007 Marek Michalkiewicz, Joerg Wunsch
   2               	   Copyright (c) 2007 Eric B. Weddington
   3               	   All rights reserved.
   4               	
   5               	   Redistribution and use in source and binary forms, with or without
   6               	   modification, are permitted provided that the following conditions are met:
   7               	
   8               	   * Redistributions of source code must retain the above copyright
   9               	     notice, this list of conditions and the following disclaimer.
  10               	
  11               	   * Redistributions in binary form must reproduce the above copyright
  12               	     notice, this list of conditions and the following disclaimer in
  13               	     the documentation and/or other materials provided with the
  14               	     distribution.
  15               	
  16               	   * Neither the name of the copyright holders nor the names of
  17               	     contributors may be used to endorse or promote products derived
  18               	     from this software without specific prior written permission.
  19               	
  20               	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  21               	  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  22               	  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  23               	  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
  24               	  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  25               	  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  26               	  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  27               	  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  28               	  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  29               	  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
  30               	  POSSIBILITY OF SUCH DAMAGE. */
  31               	
  32               	/* $Id: io.h,v 1.52.2.28 2009/12/20 17:02:53 arcanum Exp $ */
  33               	
  34               	/** \file */
  35               	/** \defgroup avr_io <avr/io.h>: AVR device-specific IO definitions
  36               	    \code #include <avr/io.h> \endcode
  37               	
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 3


  38               	    This header file includes the apropriate IO definitions for the
  39               	    device that has been specified by the <tt>-mmcu=</tt> compiler
  40               	    command-line switch.  This is done by diverting to the appropriate
  41               	    file <tt>&lt;avr/io</tt><em>XXXX</em><tt>.h&gt;</tt> which should
  42               	    never be included directly.  Some register names common to all
  43               	    AVR devices are defined directly within <tt>&lt;avr/common.h&gt;</tt>,
  44               	    which is included in <tt>&lt;avr/io.h&gt;</tt>,
  45               	    but most of the details come from the respective include file.
  46               	
  47               	    Note that this file always includes the following files:
  48               	    \code 
  49               	    #include <avr/sfr_defs.h>
  50               	    #include <avr/portpins.h>
  51               	    #include <avr/common.h>
  52               	    #include <avr/version.h>
  53               	    \endcode
  54               	    See \ref avr_sfr for more details about that header file.
  55               	
  56               	    Included are definitions of the IO register set and their
  57               	    respective bit values as specified in the Atmel documentation.
  58               	    Note that inconsistencies in naming conventions,
  59               	    so even identical functions sometimes get different names on
  60               	    different devices.
  61               	
  62               	    Also included are the specific names useable for interrupt
  63               	    function definitions as documented
  64               	    \ref avr_signames "here".
  65               	
  66               	    Finally, the following macros are defined:
  67               	
  68               	    - \b RAMEND
  69               	    <br>
  70               	    The last on-chip RAM address.
  71               	    <br>
  72               	    - \b XRAMEND
  73               	    <br>
  74               	    The last possible RAM location that is addressable. This is equal to 
  75               	    RAMEND for devices that do not allow for external RAM. For devices 
  76               	    that allow external RAM, this will be larger than RAMEND.
  77               	    <br>
  78               	    - \b E2END
  79               	    <br>
  80               	    The last EEPROM address.
  81               	    <br>
  82               	    - \b FLASHEND
  83               	    <br>
  84               	    The last byte address in the Flash program space.
  85               	    <br>
  86               	    - \b SPM_PAGESIZE
  87               	    <br>
  88               	    For devices with bootloader support, the flash pagesize
  89               	    (in bytes) to be used for the \c SPM instruction. 
  90               	    - \b E2PAGESIZE
  91               	    <br>
  92               	    The size of the EEPROM page.
  93               	    
  94               	*/
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 4


  95               	
  96               	#ifndef _AVR_IO_H_
  97               	#define _AVR_IO_H_
  98               	
  99               	#include <avr/sfr_defs.h>
   1               	/* Copyright (c) 2002, Marek Michalkiewicz <marekm@amelek.gda.pl>
 100               	
 101               	#if defined (__AVR_AT94K__)
 102               	#  include <avr/ioat94k.h>
 103               	#elif defined (__AVR_AT43USB320__)
 104               	#  include <avr/io43u32x.h>
 105               	#elif defined (__AVR_AT43USB355__)
 106               	#  include <avr/io43u35x.h>
 107               	#elif defined (__AVR_AT76C711__)
 108               	#  include <avr/io76c711.h>
 109               	#elif defined (__AVR_AT86RF401__)
 110               	#  include <avr/io86r401.h>
 111               	#elif defined (__AVR_AT90PWM1__)
 112               	#  include <avr/io90pwm1.h>
 113               	#elif defined (__AVR_AT90PWM2__)
 114               	#  include <avr/io90pwmx.h>
 115               	#elif defined (__AVR_AT90PWM2B__)
 116               	#  include <avr/io90pwm2b.h>
 117               	#elif defined (__AVR_AT90PWM3__)
 118               	#  include <avr/io90pwmx.h>
 119               	#elif defined (__AVR_AT90PWM3B__)
 120               	#  include <avr/io90pwm3b.h>
 121               	#elif defined (__AVR_AT90PWM216__)
 122               	#  include <avr/io90pwm216.h>
 123               	#elif defined (__AVR_AT90PWM316__)
 124               	#  include <avr/io90pwm316.h>
 125               	#elif defined (__AVR_AT90PWM81__)
 126               	#  include <avr/io90pwm81.h>
 127               	#elif defined (__AVR_ATmega8U2__)
 128               	#  include <avr/iom8u2.h>
 129               	#elif defined (__AVR_ATmega16M1__)
 130               	#  include <avr/iom16m1.h>
 131               	#elif defined (__AVR_ATmega16U2__)
 132               	#  include <avr/iom16u2.h>
 133               	#elif defined (__AVR_ATmega16U4__)
 134               	#  include <avr/iom16u4.h>
 135               	#elif defined (__AVR_ATmega32C1__)
 136               	#  include <avr/iom32c1.h>
 137               	#elif defined (__AVR_ATmega32M1__)
 138               	#  include <avr/iom32m1.h>
 139               	#elif defined (__AVR_ATmega32U2__)
 140               	#  include <avr/iom32u2.h>
 141               	#elif defined (__AVR_ATmega32U4__)
 142               	#  include <avr/iom32u4.h>
 143               	#elif defined (__AVR_ATmega32U6__)
 144               	#  include <avr/iom32u6.h>
 145               	#elif defined (__AVR_ATmega64C1__)
 146               	#  include <avr/iom64c1.h>
 147               	#elif defined (__AVR_ATmega64M1__)
 148               	#  include <avr/iom64m1.h>
 149               	#elif defined (__AVR_ATmega128__)
 150               	#  include <avr/iom128.h>
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 5


 151               	#elif defined (__AVR_ATmega1280__)
 152               	#  include <avr/iom1280.h>
 153               	#elif defined (__AVR_ATmega1281__)
 154               	#  include <avr/iom1281.h>
 155               	#elif defined (__AVR_ATmega1284P__)
 156               	#  include <avr/iom1284p.h>
 157               	#elif defined (__AVR_ATmega128RFA1__)
 158               	#  include <avr/iom128rfa1.h>
 159               	#elif defined (__AVR_ATmega2560__)
 160               	#  include <avr/iom2560.h>
 161               	#elif defined (__AVR_ATmega2561__)
 162               	#  include <avr/iom2561.h>
 163               	#elif defined (__AVR_AT90CAN32__)
 164               	#  include <avr/iocan32.h>
 165               	#elif defined (__AVR_AT90CAN64__)
 166               	#  include <avr/iocan64.h>
 167               	#elif defined (__AVR_AT90CAN128__)
 168               	#  include <avr/iocan128.h>
 169               	#elif defined (__AVR_AT90USB82__)
 170               	#  include <avr/iousb82.h>
 171               	#elif defined (__AVR_AT90USB162__)
 172               	#  include <avr/iousb162.h>
 173               	#elif defined (__AVR_AT90USB646__)
 174               	#  include <avr/iousb646.h>
 175               	#elif defined (__AVR_AT90USB647__)
 176               	#  include <avr/iousb647.h>
 177               	#elif defined (__AVR_AT90USB1286__)
 178               	#  include <avr/iousb1286.h>
 179               	#elif defined (__AVR_AT90USB1287__)
 180               	#  include <avr/iousb1287.h>
 181               	#elif defined (__AVR_ATmega64__)
 182               	#  include <avr/iom64.h>
 183               	#elif defined (__AVR_ATmega640__)
 184               	#  include <avr/iom640.h>
 185               	#elif defined (__AVR_ATmega644__) || defined (__AVR_ATmega644A__)
 186               	#  include <avr/iom644.h>
 187               	#elif defined (__AVR_ATmega644P__)
 188               	#  include <avr/iom644p.h>
 189               	#elif defined (__AVR_ATmega644PA__)
 190               	#  include <avr/iom644pa.h>
 191               	#elif defined (__AVR_ATmega645__) || defined (__AVR_ATmega645A__) || defined (__AVR_ATmega645P__)
 192               	#  include <avr/iom645.h>
 193               	#elif defined (__AVR_ATmega6450__) || defined (__AVR_ATmega6450A__) || defined (__AVR_ATmega6450P__
 194               	#  include <avr/iom6450.h>
 195               	#elif defined (__AVR_ATmega649__) || defined (__AVR_ATmega649A__)
 196               	#  include <avr/iom649.h>
 197               	#elif defined (__AVR_ATmega6490__) || defined (__AVR_ATmega6490A__) || defined (__AVR_ATmega6490P__
 198               	#  include <avr/iom6490.h>
 199               	#elif defined (__AVR_ATmega649P__)
 200               	#  include <avr/iom649p.h>
 201               	#elif defined (__AVR_ATmega64HVE__)
 202               	#  include <avr/iom64hve.h>
 203               	#elif defined (__AVR_ATmega103__)
 204               	#  include <avr/iom103.h>
 205               	#elif defined (__AVR_ATmega32__)
 206               	#  include <avr/iom32.h>
   1               	/* Copyright (c) 2002, Steinar Haugen
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 6


 207               	#elif defined (__AVR_ATmega323__)
 208               	#  include <avr/iom323.h>
 209               	#elif defined (__AVR_ATmega324P__) || defined (__AVR_ATmega324A__)
 210               	#  include <avr/iom324.h>
 211               	#elif defined (__AVR_ATmega324PA__)
 212               	#  include <avr/iom324pa.h>
 213               	#elif defined (__AVR_ATmega325__)
 214               	#  include <avr/iom325.h>
 215               	#elif defined (__AVR_ATmega325P__)
 216               	#  include <avr/iom325.h>
 217               	#elif defined (__AVR_ATmega3250__)
 218               	#  include <avr/iom3250.h>
 219               	#elif defined (__AVR_ATmega3250P__)
 220               	#  include <avr/iom3250.h>
 221               	#elif defined (__AVR_ATmega328P__) || defined (__AVR_ATmega328__)
 222               	#  include <avr/iom328p.h>
 223               	#elif defined (__AVR_ATmega329__)
 224               	#  include <avr/iom329.h>
 225               	#elif defined (__AVR_ATmega329P__) || defined (__AVR_ATmega329PA__)
 226               	#  include <avr/iom329.h>
 227               	#elif defined (__AVR_ATmega3290__)
 228               	#  include <avr/iom3290.h>
 229               	#elif defined (__AVR_ATmega3290P__)
 230               	#  include <avr/iom3290.h>
 231               	#elif defined (__AVR_ATmega32HVB__)
 232               	#  include <avr/iom32hvb.h>
 233               	#elif defined (__AVR_ATmega406__)
 234               	#  include <avr/iom406.h>
 235               	#elif defined (__AVR_ATmega16__)
 236               	#  include <avr/iom16.h>
 237               	#elif defined (__AVR_ATmega16A__)
 238               	#  include <avr/iom16a.h>
 239               	#elif defined (__AVR_ATmega161__)
 240               	#  include <avr/iom161.h>
 241               	#elif defined (__AVR_ATmega162__)
 242               	#  include <avr/iom162.h>
 243               	#elif defined (__AVR_ATmega163__)
 244               	#  include <avr/iom163.h>
 245               	#elif defined (__AVR_ATmega164P__) || defined (__AVR_ATmega164A__)
 246               	#  include <avr/iom164.h>
 247               	#elif defined (__AVR_ATmega165__) || defined (__AVR_ATmega165A__)
 248               	#  include <avr/iom165.h>
 249               	#elif defined (__AVR_ATmega165P__)
 250               	#  include <avr/iom165p.h>
 251               	#elif defined (__AVR_ATmega168__) || defined (__AVR_ATmega168A__)
 252               	#  include <avr/iom168.h>
 253               	#elif defined (__AVR_ATmega168P__)
 254               	#  include <avr/iom168p.h>
 255               	#elif defined (__AVR_ATmega169__) || defined (__AVR_ATmega169A__)
 256               	#  include <avr/iom169.h>
 257               	#elif defined (__AVR_ATmega169P__)
 258               	#  include <avr/iom169p.h>
 259               	#elif defined (__AVR_ATmega169PA__)
 260               	#  include <avr/iom169pa.h>
 261               	#elif defined (__AVR_ATmega8HVA__)
 262               	#  include <avr/iom8hva.h>
 263               	#elif defined (__AVR_ATmega16HVA__)
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 7


 264               	#  include <avr/iom16hva.h>
 265               	#elif defined (__AVR_ATmega16HVA2__)
 266               	#  include <avr/iom16hva2.h>
 267               	#elif defined (__AVR_ATmega16HVB__)
 268               	#  include <avr/iom16hvb.h>
 269               	#elif defined (__AVR_ATmega8__)
 270               	#  include <avr/iom8.h>
 271               	#elif defined (__AVR_ATmega48__) || defined (__AVR_ATmega48A__)
 272               	#  include <avr/iom48.h>
 273               	#elif defined (__AVR_ATmega48P__)
 274               	#  include <avr/iom48p.h>
 275               	#elif defined (__AVR_ATmega88__) || defined (__AVR_ATmega88A__)
 276               	#  include <avr/iom88.h>
 277               	#elif defined (__AVR_ATmega88P__)
 278               	#  include <avr/iom88p.h>
 279               	#elif defined (__AVR_ATmega88PA__)
 280               	#  include <avr/iom88pa.h>
 281               	#elif defined (__AVR_ATmega8515__)
 282               	#  include <avr/iom8515.h>
 283               	#elif defined (__AVR_ATmega8535__)
 284               	#  include <avr/iom8535.h>
 285               	#elif defined (__AVR_AT90S8535__)
 286               	#  include <avr/io8535.h>
 287               	#elif defined (__AVR_AT90C8534__)
 288               	#  include <avr/io8534.h>
 289               	#elif defined (__AVR_AT90S8515__)
 290               	#  include <avr/io8515.h>
 291               	#elif defined (__AVR_AT90S4434__)
 292               	#  include <avr/io4434.h>
 293               	#elif defined (__AVR_AT90S4433__)
 294               	#  include <avr/io4433.h>
 295               	#elif defined (__AVR_AT90S4414__)
 296               	#  include <avr/io4414.h>
 297               	#elif defined (__AVR_ATtiny22__)
 298               	#  include <avr/iotn22.h>
 299               	#elif defined (__AVR_ATtiny26__)
 300               	#  include <avr/iotn26.h>
 301               	#elif defined (__AVR_AT90S2343__)
 302               	#  include <avr/io2343.h>
 303               	#elif defined (__AVR_AT90S2333__)
 304               	#  include <avr/io2333.h>
 305               	#elif defined (__AVR_AT90S2323__)
 306               	#  include <avr/io2323.h>
 307               	#elif defined (__AVR_AT90S2313__)
 308               	#  include <avr/io2313.h>
 309               	#elif defined (__AVR_ATtiny2313__)
 310               	#  include <avr/iotn2313.h>
 311               	#elif defined (__AVR_ATtiny2313A__)
 312               	#  include <avr/iotn2313a.h>
 313               	#elif defined (__AVR_ATtiny13__)
 314               	#  include <avr/iotn13.h>
 315               	#elif defined (__AVR_ATtiny13A__)
 316               	#  include <avr/iotn13a.h>
 317               	#elif defined (__AVR_ATtiny25__)
 318               	#  include <avr/iotn25.h>
 319               	#elif defined (__AVR_ATtiny4313__)
 320               	#  include <avr/iotn4313.h>
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 8


 321               	#elif defined (__AVR_ATtiny45__)
 322               	#  include <avr/iotn45.h>
 323               	#elif defined (__AVR_ATtiny85__)
 324               	#  include <avr/iotn85.h>
 325               	#elif defined (__AVR_ATtiny24__)
 326               	#  include <avr/iotn24.h>
 327               	#elif defined (__AVR_ATtiny24A__)
 328               	#  include <avr/iotn24a.h>
 329               	#elif defined (__AVR_ATtiny44__)
 330               	#  include <avr/iotn44.h>
 331               	#elif defined (__AVR_ATtiny44A__)
 332               	#  include <avr/iotn44a.h>
 333               	#elif defined (__AVR_ATtiny84__)
 334               	#  include <avr/iotn84.h>
 335               	#elif defined (__AVR_ATtiny261__)
 336               	#  include <avr/iotn261.h>
 337               	#elif defined (__AVR_ATtiny261A__)
 338               	#  include <avr/iotn261a.h>
 339               	#elif defined (__AVR_ATtiny461__)
 340               	#  include <avr/iotn461.h>
 341               	#elif defined (__AVR_ATtiny461A__)
 342               	#  include <avr/iotn461a.h>
 343               	#elif defined (__AVR_ATtiny861__)
 344               	#  include <avr/iotn861.h>
 345               	#elif defined (__AVR_ATtiny861A__)
 346               	#  include <avr/iotn861a.h>
 347               	#elif defined (__AVR_ATtiny43U__)
 348               	#  include <avr/iotn43u.h>
 349               	#elif defined (__AVR_ATtiny48__)
 350               	#  include <avr/iotn48.h>
 351               	#elif defined (__AVR_ATtiny88__)
 352               	#  include <avr/iotn88.h>
 353               	#elif defined (__AVR_ATtiny87__)
 354               	#  include <avr/iotn87.h>
 355               	#elif defined (__AVR_ATtiny167__)
 356               	#  include <avr/iotn167.h>
 357               	#elif defined (__AVR_AT90SCR100__)
 358               	#  include <avr/io90scr100.h>
 359               	#elif defined (__AVR_ATxmega16A4__)
 360               	#  include <avr/iox16a4.h>
 361               	#elif defined (__AVR_ATxmega16D4__)
 362               	#  include <avr/iox16d4.h>
 363               	#elif defined (__AVR_ATxmega32A4__)
 364               	#  include <avr/iox32a4.h>
 365               	#elif defined (__AVR_ATxmega32D4__)
 366               	#  include <avr/iox32d4.h>
 367               	#elif defined (__AVR_ATxmega64A1__)
 368               	#  include <avr/iox64a1.h>
 369               	#elif defined (__AVR_ATxmega64A3__)
 370               	#  include <avr/iox64a3.h>
 371               	#elif defined (__AVR_ATxmega64D3__)
 372               	#  include <avr/iox64d3.h>
 373               	#elif defined (__AVR_ATxmega128A1__)
 374               	#  include <avr/iox128a1.h>
 375               	#elif defined (__AVR_ATxmega128A3__)
 376               	#  include <avr/iox128a3.h>
 377               	#elif defined (__AVR_ATxmega128D3__)
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 9


 378               	#  include <avr/iox128d3.h>
 379               	#elif defined (__AVR_ATxmega192A3__)
 380               	#  include <avr/iox192a3.h>
 381               	#elif defined (__AVR_ATxmega192D3__)
 382               	#  include <avr/iox192d3.h>
 383               	#elif defined (__AVR_ATxmega256A3__)
 384               	#  include <avr/iox256a3.h>
 385               	#elif defined (__AVR_ATxmega256A3B__)
 386               	#  include <avr/iox256a3b.h>
 387               	#elif defined (__AVR_ATxmega256D3__)
 388               	#  include <avr/iox256d3.h>
 389               	#elif defined (__AVR_ATA6289__)
 390               	#  include <avr/ioa6289.h>
 391               	/* avr1: the following only supported for assembler programs */
 392               	#elif defined (__AVR_ATtiny28__)
 393               	#  include <avr/iotn28.h>
 394               	#elif defined (__AVR_AT90S1200__)
 395               	#  include <avr/io1200.h>
 396               	#elif defined (__AVR_ATtiny15__)
 397               	#  include <avr/iotn15.h>
 398               	#elif defined (__AVR_ATtiny12__)
 399               	#  include <avr/iotn12.h>
 400               	#elif defined (__AVR_ATtiny11__)
 401               	#  include <avr/iotn11.h>
 402               	#else
 403               	#  if !defined(__COMPILING_AVR_LIBC__)
 404               	#    warning "device type not defined"
 405               	#  endif
 406               	#endif
 407               	
 408               	#include <avr/portpins.h>
   1               	/* Copyright (c) 2003  Theodore A. Roth
 409               	
 410               	#include <avr/common.h>
   1               	/* Copyright (c) 2007 Eric B. Weddington
 411               	
 412               	#include <avr/version.h>
   1               	/* Copyright (c) 2005, Joerg Wunsch                               -*- c -*-
 413               	
 414               	/* Include fuse.h after individual IO header files. */
 415               	#include <avr/fuse.h>
   1               	/* Copyright (c) 2007, Atmel Corporation
 416               	
 417               	/* Include lock.h after individual IO header files. */
 418               	#include <avr/lock.h>
   1               	/* Copyright (c) 2007, Atmel Corporation
 419               	
  75               	
  76               	#define OS_CPU_A
  77               	#include "os_cpu.h"
   1               	/*
  78               	#define typedef	; 
  79               	#include "os_cfg.h"
   1               	/*
   2               	***************************************************************************************************
   3               	*                                                uC/OS-II
   4               	*                                          The Real-Time Kernel
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 10


   5               	*
   6               	*                           (c) Copyright 1992-2003, Jean J. Labrosse, Weston, FL
   7               	*                                           All Rights Reserved
   8               	*
   9               	*                                  uC/OS-II Configuration File for V2.7x
  10               	*
  11               	* File : OS_CFG.H
  12               	* By   : Jean J. Labrosse
  13               	*
  14               	* Modifications by Julius Luukko 2003-07-14 (Julius.Luukko@lut.fi) for avr-gcc test program.
  15               	*
  16               	* - CPU_CLOCK_HZ must be defined here (used in os_cpu_a.asm)
  17               	* - defines a default stack size, which is used in all stack size definitions
  18               	*
  19               	* Your applications must define CPU_CLOCK_HZ!
  20               	*
  21               	***************************************************************************************************
  22               	*/
  23               	
  24               	#ifndef OS_CFG_H
  25               	#define OS_CFG_H
  26               	
  27               	#define CPU_CLOCK_HZ       16000000
  28               	
  29               	#define OS_TASK_DEF_STK_SIZE    128    /* Default stack size                                       
  30               	
  31               	                                       /* ---------------------- MISCELLANEOUS --------------------
  32               	#define OS_ARG_CHK_EN             0    /* Enable (1) or Disable (0) argument checking              
  33               	#define OS_CPU_HOOKS_EN           1    /* uC/OS-II hooks are found in the processor port files     
  34               	
  35               	#define OS_DEBUG_EN               1    /* Enable(1) debug variables                                
  36               	
  37               	#define OS_EVENT_NAME_SIZE       32    /* Determine the size of the name of a Sem, Mutex, Mbox or Q
  38               	
  39               	#define OS_LOWEST_PRIO           12    /* Defines the lowest priority that can be assigned ...     
  40               	                                       /* ... MUST NEVER be higher than 63!                        
  41               	
  42               	#define OS_MAX_EVENTS             6    /* Max. number of event control blocks in your application  
  43               	#define OS_MAX_FLAGS              1    /* Max. number of Event Flag Groups    in your application  
  44               	#define OS_MAX_MEM_PART           1    /* Max. number of memory partitions                         
  45               	#define OS_MAX_QS                 2    /* Max. number of queue control blocks in your application  
  46               	#define OS_MAX_TASKS             11    /* Max. number of tasks in your application, MUST be >= 2   
  47               	
  48               	#define OS_SCHED_LOCK_EN          1    /*     Include code for OSSchedLock() and OSSchedUnlock()   
  49               	
  50               	#define OS_TASK_IDLE_STK_SIZE   OS_TASK_DEF_STK_SIZE
  51               	                                       /* Idle task stack size (# of OS_STK wide entries)          
  52               	
  53               	#define OS_TASK_STAT_EN           1    /* Enable (1) or Disable(0) the statistics task             
  54               	#define OS_TASK_STAT_STK_SIZE   OS_TASK_DEF_STK_SIZE
  55               	                                       /* Statistics task stack size (# of OS_STK wide entries)    
  56               	#define OS_TASK_STAT_STK_CHK_EN   1    /* Check task stacks from statistic task                    
  57               	
  58               	#define OS_TICK_STEP_EN           1    /* Enable tick stepping feature for uC/OS-View              
  59               	#define OS_TICKS_PER_SEC         61    /* Set the number of ticks in one second                    
  60               	
  61               	
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 11


  62               	                                       /* ----------------------- EVENT FLAGS ---------------------
  63               	#define OS_FLAG_EN                0    /* Enable (1) or Disable (0) code generation for EVENT FLAGS
  64               	#define OS_FLAG_WAIT_CLR_EN       0    /* Include code for Wait on Clear EVENT FLAGS               
  65               	#define OS_FLAG_ACCEPT_EN         0    /*     Include code for OSFlagAccept()                      
  66               	#define OS_FLAG_DEL_EN            0    /*     Include code for OSFlagDel()                         
  67               	#define OS_FLAG_NAME_SIZE        32    /*     Determine the size of the name of an event flag group
  68               	#define OS_FLAG_QUERY_EN          0    /*     Include code for OSFlagQuery()                       
  69               	
  70               	
  71               	                                       /* -------------------- MESSAGE MAILBOXES ------------------
  72               	#define OS_MBOX_EN                1    /* Enable (1) or Disable (0) code generation for MAILBOXES  
  73               	#define OS_MBOX_ACCEPT_EN         0    /*     Include code for OSMboxAccept()                      
  74               	#define OS_MBOX_DEL_EN            0    /*     Include code for OSMboxDel()                         
  75               	#define OS_MBOX_POST_EN           1    /*     Include code for OSMboxPost()                        
  76               	#define OS_MBOX_POST_OPT_EN       0    /*     Include code for OSMboxPostOpt()                     
  77               	#define OS_MBOX_QUERY_EN          0    /*     Include code for OSMboxQuery()                       
  78               	
  79               	
  80               	                                       /* --------------------- MEMORY MANAGEMENT -----------------
  81               	#define OS_MEM_EN                 1    /* Enable (1) or Disable (0) code generation for MEMORY MANA
  82               	#define OS_MEM_QUERY_EN           0    /*     Include code for OSMemQuery()                        
  83               	#define OS_MEM_NAME_SIZE         32    /*     Determine the size of a memory partition name        
  84               	
  85               	
  86               	                                       /* ---------------- MUTUAL EXCLUSION SEMAPHORES ------------
  87               	#define OS_MUTEX_EN               0    /* Enable (1) or Disable (0) code generation for MUTEX      
  88               	#define OS_MUTEX_ACCEPT_EN        0    /*     Include code for OSMutexAccept()                     
  89               	#define OS_MUTEX_DEL_EN           0    /*     Include code for OSMutexDel()                        
  90               	#define OS_MUTEX_QUERY_EN         0    /*     Include code for OSMutexQuery()                      
  91               	
  92               	
  93               	                                       /* ---------------------- MESSAGE QUEUES -------------------
  94               	#define OS_Q_EN                   0    /* Enable (1) or Disable (0) code generation for QUEUES     
  95               	#define OS_Q_ACCEPT_EN            0    /*     Include code for OSQAccept()                         
  96               	#define OS_Q_DEL_EN               0    /*     Include code for OSQDel()                            
  97               	#define OS_Q_FLUSH_EN             0    /*     Include code for OSQFlush()                          
  98               	#define OS_Q_POST_EN              0    /*     Include code for OSQPost()                           
  99               	#define OS_Q_POST_FRONT_EN        0    /*     Include code for OSQPostFront()                      
 100               	#define OS_Q_POST_OPT_EN          0    /*     Include code for OSQPostOpt()                        
 101               	#define OS_Q_QUERY_EN             0    /*     Include code for OSQQuery()                          
 102               	
 103               	
 104               	                                       /* ------------------------ SEMAPHORES ---------------------
 105               	#define OS_SEM_EN                 1    /* Enable (1) or Disable (0) code generation for SEMAPHORES 
 106               	#define OS_SEM_ACCEPT_EN          1    /*    Include code for OSSemAccept()                        
 107               	#define OS_SEM_DEL_EN             0    /*    Include code for OSSemDel()                           
 108               	#define OS_SEM_QUERY_EN           0    /*    Include code for OSSemQuery()                         
 109               	
 110               	
 111               	                                       /* --------------------- TASK MANAGEMENT -------------------
 112               	#define OS_TASK_CHANGE_PRIO_EN    0    /*     Include code for OSTaskChangePrio()                  
 113               	#define OS_TASK_CREATE_EN         1    /*     Include code for OSTaskCreate()                      
 114               	#define OS_TASK_CREATE_EXT_EN     0    /*     Include code for OSTaskCreateExt()                   
 115               	#define OS_TASK_DEL_EN            1    /*     Include code for OSTaskDel()                         
 116               	#define OS_TASK_NAME_SIZE        32    /*     Determine the size of a task name                    
 117               	#define OS_TASK_PROFILE_EN        0    /*     Include variables in OS_TCB for profiling            
 118               	#define OS_TASK_QUERY_EN          0    /*     Include code for OSTaskQuery()                       
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 12


 119               	#define OS_TASK_SUSPEND_EN        0    /*     Include code for OSTaskSuspend() and OSTaskResume()  
 120               	#define OS_TASK_SW_HOOK_EN        1    /*     Include code for OSTaskSwHook()                      
 121               	
 122               	
 123               	                                       /* --------------------- TIME MANAGEMENT -------------------
 124               	#define OS_TIME_DLY_HMSM_EN       1    /*     Include code for OSTimeDlyHMSM()                     
 125               	#define OS_TIME_DLY_RESUME_EN     0    /*     Include code for OSTimeDlyResume()                   
 126               	#define OS_TIME_GET_SET_EN        0    /*     Include code for OSTimeGet() and OSTimeSet()         
 127               	#define OS_TIME_TICK_HOOK_EN      1    /*     Include code for OSTimeTickHook()                    
 128               	
 129               	
 130               	typedef INT8U             OS_FLAGS;    /* Data type for event flag bits (8, 16 or 32 bits)         
 131               	
  80               	
  81               	#ifndef OS_TASK_SW_HOOK_EN
  82               	#define OS_TASK_SW_HOOK_EN 1
  83               	#endif
  84               		
  85               	;**************************************************************************************************
  86               	;                                          PUBLIC DECLARATIONS
  87               	;**************************************************************************************************
  88               	
  89               	                .global OSStartHighRdy
  90               	                .global OSCtxSw
  91               	                .global OSIntCtxSw
  92               	                .global	OSTickISR
  93               	
  94               	;**************************************************************************************************
  95               	;                                         EXTERNAL DECLARATIONS
  96               	;**************************************************************************************************
  97               	
  98               	                .extern	OSIntExit
  99               	                .extern	OSIntNesting
 100               	                .extern	OSPrioCur
 101               	                .extern	OSPrioHighRdy
 102               	                .extern	OSRunning
 103               	#if OS_TASK_SW_HOOK_EN > 0
 104               	                .extern	OSTaskSwHook
 105               	#endif
 106               	                .extern	OSTCBCur
 107               	                .extern	OSTCBHighRdy
 108               	                .extern	OSTimeTick
 109               	
 110               	;**************************************************************************************************
 111               	;                                         MACROS
 112               	;**************************************************************************************************
 113               	
 114               	; Push all registers and the status register	
 115               	.macro	PUSHRS
 116               	
 117               	                push	r0
 118               	                push	r1
 119               	                push	r2
 120               	                push	r3
 121               	                push	r4
 122               	                push	r5
 123               	                push	r6
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 13


 124               	                push	r7
 125               	                push	r8
 126               	                push	r9
 127               	                push	r10
 128               	                push	r11
 129               	                push	r12
 130               	                push	r13
 131               	                push	r14
 132               	                push	r15
 133               	                push	r16
 134               	                push	r17
 135               	                push	r18
 136               	                push	r19
 137               	                push	r20
 138               	                push	r21
 139               	                push	r22
 140               	                push	r23
 141               	                push	r24
 142               	                push	r25
 143               	                push	r26
 144               	                push	r27
 145               	                push	r28
 146               	                push	r29
 147               	                push	r30
 148               	                push	r31
 149               	#ifdef RAMPZ
 150               	                in      r16,_SFR_IO_ADDR(RAMPZ)
 151               	                push	r16
 152               	#endif
 153               	.endm
 154               	
 155               	; Pop all registers and the status registers
 156               	.macro	POPRS
 157               	
 158               	#ifdef RAMPZ
 159               	                pop     r16
 160               	                out     _SFR_IO_ADDR(RAMPZ),r16
 161               	#endif
 162               	                pop     r31
 163               	                pop     r30
 164               	                pop     r29
 165               	                pop     r28
 166               	                pop     r27
 167               	                pop     r26
 168               	                pop     r25
 169               	                pop     r24
 170               	                pop     r23
 171               	                pop     r22
 172               	                pop     r21
 173               	                pop     r20
 174               	                pop     r19
 175               	                pop     r18
 176               	                pop     r17
 177               	                pop     r16
 178               	                pop     r15
 179               	                pop     r14
 180               	                pop     r13
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 14


 181               	                pop     r12
 182               	                pop     r11
 183               	                pop     r10
 184               	                pop     r9
 185               	                pop     r8
 186               	                pop     r7
 187               	                pop     r6
 188               	                pop     r5
 189               	                pop     r4
 190               	                pop     r3
 191               	                pop     r2
 192               	                pop     r1
 193               	                pop     r0
 194               	
 195               	.endm
 196               	
 197               	.macro	POPSREG
 198               	
 199               	                pop     r16
 200               	                out     _SFR_IO_ADDR(SREG),r16
 201               	
 202               	.endm
 203               	
 204               	.macro	PUSHSREG
 205               	
 206               	                in      r16,_SFR_IO_ADDR(SREG)
 207               	                push	r16
 208               	
 209               	.endm
 210               	
 211               	.macro	PUSHSREGISR
 212               	
 213               	                in      r16,_SFR_IO_ADDR(SREG)
 214               	                sbr     r16,0x80
 215               	                push	r16
 216               	
 217               	.endm
 218               	
 219               	
 220               	                	.text
 221               	                	.section	.text
 222               				
 223               	
 224               	;**************************************************************************************************
 225               	;                               START HIGHEST PRIORITY TASK READY-TO-RUN
 226               	;
 227               	; Description : This function is called by OSStart() to start the highest priority task that was cr
 228               	;               by your application before calling OSStart().
 229               	;
 230               	; Note(s)     : 1) The (data)stack frame is assumed to look as follows:
 231               	;
 232               	;                  OSTCBHighRdy->OSTCBStkPtr --> LSB of (return) stack pointer           (Low memor
 233               	;                                                SPH of (return) stack pointer
 234               	;                                                Flags to load in status register
 235               	;                                                R31
 236               	;                                                R30
 237               	;                                                R7
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 15


 238               	;                                                .
 239               	;                                                .
 240               	;                                                .
 241               	;                                                R0
 242               	;                                                PCH
 243               	;                                                PCL                                     (High memo
 244               	;
 245               	;                  where the stack pointer points to the task start address.
 246               	;
 247               	;
 248               	;               2) OSStartHighRdy() MUST:
 249               	;                      a) Call OSTaskSwHook() then,
 250               	;                      b) Set OSRunning to TRUE,
 251               	;                      c) Switch to the highest priority task.
 252               	;**************************************************************************************************
 253               	
 254               	OSStartHighRdy: 
 255               	#if OS_TASK_SW_HOOK_EN > 0
 256               	#if FLASHEND >= 0x2000
 257:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm **** 	        call    OSTaskSwHook                ; Invoke user defined context switch hook
 258               	#else
 259               		        rcall   OSTaskSwHook                ; Use relative call with small devices (<=8 kB SRAM)
 260               	#endif
 261               	#endif
 262:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R16,OSRunning               ; Indicate that we are multitasking
 263:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 inc     R16                         ;
 264:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSRunning,R16               ;
 265               	
 266:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R30,OSTCBHighRdy            ; Let Z point to TCB of highest priority task
 267:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R31,OSTCBHighRdy+1          ; ready to run
 268               	
 269:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ld      R28,Z+                      ; Load stack L pointer
 270:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 out     _SFR_IO_ADDR(SPL),R28
 271:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ld      R29,Z+                      ;
 272:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 out     _SFR_IO_ADDR(SPH),R29
 273               	
 274:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPSREG                             ; Pop the status register
 274               	> 
 274 001e 0F91      	> pop r16
 274 0020 0FBF      	> out ((((0x3F)+0x20))-0x20),r16
 274               	> 
 275:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPRS                               ; Pop all registers
 275               	> 
 275               	> 
 275               	> 
 275               	> 
 275               	> 
 275 0022 FF91      	> pop r31
 275 0024 EF91      	> pop r30
 275 0026 DF91      	> pop r29
 275 0028 CF91      	> pop r28
 275 002a BF91      	> pop r27
 275 002c AF91      	> pop r26
 275 002e 9F91      	> pop r25
 275 0030 8F91      	> pop r24
 275 0032 7F91      	> pop r23
 275 0034 6F91      	> pop r22
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 16


 275 0036 5F91      	> pop r21
 275 0038 4F91      	> pop r20
 275 003a 3F91      	> pop r19
 275 003c 2F91      	> pop r18
 275 003e 1F91      	> pop r17
 275 0040 0F91      	> pop r16
 275 0042 FF90      	> pop r15
 275 0044 EF90      	> pop r14
 275 0046 DF90      	> pop r13
 275 0048 CF90      	> pop r12
 275 004a BF90      	> pop r11
 275 004c AF90      	> pop r10
 275 004e 9F90      	> pop r9
 275 0050 8F90      	> pop r8
 275 0052 7F90      	> pop r7
 275 0054 6F90      	> pop r6
 275 0056 5F90      	> pop r5
 275 0058 4F90      	> pop r4
 275 005a 3F90      	> pop r3
 275 005c 2F90      	> pop r2
 275 005e 1F90      	> pop r1
 275 0060 0F90      	> pop r0
 275               	> 
 276:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ret                                 ; Start task
 277               	
 278               	;**************************************************************************************************
 279               	;                                       TASK LEVEL CONTEXT SWITCH
 280               	;
 281               	; Description : This function is called when a task makes a higher priority task ready-to-run.
 282               	;
 283               	; Note(s)     : 1) Upon entry,
 284               	;                  OSTCBCur     points to the OS_TCB of the task to suspend
 285               	;                  OSTCBHighRdy points to the OS_TCB of the task to resume
 286               	;
 287               	;               2) The stack frame of the task to suspend looks as follows:
 288               	;
 289               	;                                       SP+0 --> LSB of task code address
 290               	;                                         +1     MSB of task code address                (High memo
 291               	;
 292               	;               3) The saved context of the task to resume looks as follows:
 293               	;
 294               	;                  OSTCBHighRdy->OSTCBStkPtr --> Flags to load in status register (Low memory)
 295               	;                                                R31
 296               	;                                                R30
 297               	;                                                R7
 298               	;                                                .
 299               	;                                                .
 300               	;                                                .
 301               	;                                                R0
 302               	;                                                PCH
 303               	;                                                PCL                                     (High memo
 304               	;**************************************************************************************************
 305               	
 306:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm **** OSCtxSw:        PUSHRS                              ; Save current tasks context
 306               	> 
 306 0064 0F92      	> push r0
 306 0066 1F92      	> push r1
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 17


 306 0068 2F92      	> push r2
 306 006a 3F92      	> push r3
 306 006c 4F92      	> push r4
 306 006e 5F92      	> push r5
 306 0070 6F92      	> push r6
 306 0072 7F92      	> push r7
 306 0074 8F92      	> push r8
 306 0076 9F92      	> push r9
 306 0078 AF92      	> push r10
 306 007a BF92      	> push r11
 306 007c CF92      	> push r12
 306 007e DF92      	> push r13
 306 0080 EF92      	> push r14
 306 0082 FF92      	> push r15
 306 0084 0F93      	> push r16
 306 0086 1F93      	> push r17
 306 0088 2F93      	> push r18
 306 008a 3F93      	> push r19
 306 008c 4F93      	> push r20
 306 008e 5F93      	> push r21
 306 0090 6F93      	> push r22
 306 0092 7F93      	> push r23
 306 0094 8F93      	> push r24
 306 0096 9F93      	> push r25
 306 0098 AF93      	> push r26
 306 009a BF93      	> push r27
 306 009c CF93      	> push r28
 306 009e DF93      	> push r29
 306 00a0 EF93      	> push r30
 306 00a2 FF93      	> push r31
 306               	> 
 306               	> 
 306               	> 
 306               	> 
 307:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 PUSHSREG                            ; Save SREG
 307               	> 
 307 00a4 0FB7      	> in r16,((((0x3F)+0x20))-0x20)
 307 00a6 0F93      	> push r16
 307               	> 
 308               	
 309:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R30,OSTCBCur                ; Z = OSTCBCur->OSTCBStkPtr
 310:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R31,OSTCBCur+1              ;
 311               	
 312:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 in      r28,_SFR_IO_ADDR(SPL)
 313:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 st      Z+,R28                      ; Save Y (R29:R28) pointer
 314:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 in      r29,_SFR_IO_ADDR(SPH)
 315:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 st      Z+,R29                      ;
 316               	
 317               	#if OS_TASK_SW_HOOK_EN > 0
 318               	#if FLASHEND >= 0x2000
 319:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm **** 	        call    OSTaskSwHook                ; Invoke user defined context switch hook
 320               	#else
 321               		        rcall   OSTaskSwHook                ; Use relative call with small devices (<=8 kB SRAM)
 322               	#endif
 323               	#endif
 324               	
 325:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R16,OSPrioHighRdy           ; OSPrioCur = OSPrioHighRdy
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 18


 326:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSPrioCur,R16
 327               	
 328:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R30,OSTCBHighRdy            ; Let Z point to TCB of highest priority task
 329:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R31,OSTCBHighRdy+1          ; ready to run
 330:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSTCBCur,R30                ; OSTCBCur = OSTCBHighRdy
 331:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSTCBCur+1,R31              ;
 332               	
 333:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ld      R28,Z+                      ; Restore Y pointer
 334:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 out     _SFR_IO_ADDR(SPL),R28
 335:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ld      R29,Z+                      ;
 336:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 out     _SFR_IO_ADDR(SPH),R29
 337               	
 338:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPSREG                             ; Restore the status register
 338               	> 
 338 00dc 0F91      	> pop r16
 338 00de 0FBF      	> out ((((0x3F)+0x20))-0x20),r16
 338               	> 
 339:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPRS                               ; Restore all registers
 339               	> 
 339               	> 
 339               	> 
 339               	> 
 339               	> 
 339 00e0 FF91      	> pop r31
 339 00e2 EF91      	> pop r30
 339 00e4 DF91      	> pop r29
 339 00e6 CF91      	> pop r28
 339 00e8 BF91      	> pop r27
 339 00ea AF91      	> pop r26
 339 00ec 9F91      	> pop r25
 339 00ee 8F91      	> pop r24
 339 00f0 7F91      	> pop r23
 339 00f2 6F91      	> pop r22
 339 00f4 5F91      	> pop r21
 339 00f6 4F91      	> pop r20
 339 00f8 3F91      	> pop r19
 339 00fa 2F91      	> pop r18
 339 00fc 1F91      	> pop r17
 339 00fe 0F91      	> pop r16
 339 0100 FF90      	> pop r15
 339 0102 EF90      	> pop r14
 339 0104 DF90      	> pop r13
 339 0106 CF90      	> pop r12
 339 0108 BF90      	> pop r11
 339 010a AF90      	> pop r10
 339 010c 9F90      	> pop r9
 339 010e 8F90      	> pop r8
 339 0110 7F90      	> pop r7
 339 0112 6F90      	> pop r6
 339 0114 5F90      	> pop r5
 339 0116 4F90      	> pop r4
 339 0118 3F90      	> pop r3
 339 011a 2F90      	> pop r2
 339 011c 1F90      	> pop r1
 339 011e 0F90      	> pop r0
 339               	> 
 340:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ret
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 19


 341               	
 342               	
 343               	;**************************************************************************************************
 344               	;                                INTERRUPT LEVEL CONTEXT SWITCH
 345               	;
 346               	; Description : This function is called by OSIntExit() to perform a context switch to a task that h
 347               	;               been made ready-to-run by an ISR.
 348               	;
 349               	; Note(s)     : 1) Upon entry,
 350               	;                  OSTCBCur     points to the OS_TCB of the task to suspend
 351               	;                  OSTCBHighRdy points to the OS_TCB of the task to resume
 352               	;
 353               	;               2) The stack frame of the task to suspend looks as follows:
 354               	;
 355               	;                  OSTCBCur->OSTCBStkPtr ------> Flags to load in status register        (Low memor
 356               	;                                                R31
 357               	;                                                R30
 358               	;                                                R27
 359               	;                                                .
 360               	;                                                .
 361               	;                                                R0
 362               	;                                                PCH
 363               	;                                                PCL                                     (High memo
 364               	;
 365               	;               3) The saved context of the task to resume looks as follows:
 366               	;
 367               	;                  OSTCBHighRdy->OSTCBStkPtr --> Flags to load in status register         (Low memo
 368               	;                                                R31
 369               	;                                                R30
 370               	;                                                R7
 371               	;                                                .
 372               	;                                                .
 373               	;                                                .
 374               	;                                                R0                                      (High memo
 375               	;**************************************************************************************************
 376               	
 377               	OSIntCtxSw:     
 378               	;**************************************************************************************************
 379               	; You should enable the lines between #if 0 and #endif only if you use uC/OS-II version 2.51 or bel
 380               	; (Unfortunately OS_VERSION is not defined here (how to do it elegantly?)
 381               	;**************************************************************************************************
 382               	#if 0
 383               	                in      R28,_SFR_IO_ADDR(SPL)       ; Z = SP
 384               	                in      R29,_SFR_IO_ADDR(SPH)
 385               	
 386               	#if      OS_CRITICAL_METHOD == 1
 387               	                adiw    R28,4                       ; Use if OS_CRITICAL_METHOD is 1, see OS_CPU.H
 388               	#endif
 389               	#if      OS_CRITICAL_METHOD == 2
 390               	                adiw    R28,5                       ; Use if OS_CRITICAL_METHOD is 2, see OS_CPU.H
 391               	#endif
 392               	
 393               	                lds     R30,OSTCBCur                ; Z = OSTCBCur->OSTCBStkPtr
 394               	                lds     R31,OSTCBCur+1              ;
 395               	                st      Z+,R28                      ; Save Y pointer
 396               	                st      Z+,R29                      ;
 397               	#endif
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 20


 398               	;**************************************************************************************************
 399               	
 400               	#if OS_TASK_SW_HOOK_EN > 0
 401               	#if FLASHEND >= 0x2000
 402:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm **** 	        call    OSTaskSwHook                ; Invoke user defined context switch hook
 403               	#else
 404               		        rcall   OSTaskSwHook                ; Use relative call with small devices (<=8 kB SRAM)
 405               	#endif
 406               	#endif
 407:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R16,OSPrioHighRdy           ; OSPrioCur = OSPrioHighRdy
 408:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSPrioCur,R16               ;
 409               	
 410:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R30,OSTCBHighRdy            ; Z = OSTCBHighRdy->OSTCBStkPtr
 411:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R31,OSTCBHighRdy+1          ;
 412:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSTCBCur,R30                ; OSTCBCur = OSTCBHighRdy
 413:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSTCBCur+1,R31              ;
 414               	
 415:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ld      R28,Z+                      ; Restore Y pointer
 416:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 out     _SFR_IO_ADDR(SPL),R28
 417:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ld      R29,Z+                      ;
 418:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 out     _SFR_IO_ADDR(SPH),R29
 419               	
 420:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPSREG                             ; Restore the status register
 420               	> 
 420 0146 0F91      	> pop r16
 420 0148 0FBF      	> out ((((0x3F)+0x20))-0x20),r16
 420               	> 
 421:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPRS                               ; Restore all registers
 421               	> 
 421               	> 
 421               	> 
 421               	> 
 421               	> 
 421 014a FF91      	> pop r31
 421 014c EF91      	> pop r30
 421 014e DF91      	> pop r29
 421 0150 CF91      	> pop r28
 421 0152 BF91      	> pop r27
 421 0154 AF91      	> pop r26
 421 0156 9F91      	> pop r25
 421 0158 8F91      	> pop r24
 421 015a 7F91      	> pop r23
 421 015c 6F91      	> pop r22
 421 015e 5F91      	> pop r21
 421 0160 4F91      	> pop r20
 421 0162 3F91      	> pop r19
 421 0164 2F91      	> pop r18
 421 0166 1F91      	> pop r17
 421 0168 0F91      	> pop r16
 421 016a FF90      	> pop r15
 421 016c EF90      	> pop r14
 421 016e DF90      	> pop r13
 421 0170 CF90      	> pop r12
 421 0172 BF90      	> pop r11
 421 0174 AF90      	> pop r10
 421 0176 9F90      	> pop r9
 421 0178 8F90      	> pop r8
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 21


 421 017a 7F90      	> pop r7
 421 017c 6F90      	> pop r6
 421 017e 5F90      	> pop r5
 421 0180 4F90      	> pop r4
 421 0182 3F90      	> pop r3
 421 0184 2F90      	> pop r2
 421 0186 1F90      	> pop r1
 421 0188 0F90      	> pop r0
 421               	> 
 422:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ret
 423               	
 424               	;**************************************************************************************************
 425               	;                                           SYSTEM TICK ISR
 426               	;
 427               	; Description : This function is the ISR used to notify uC/OS-II that a system tick has occurred.
 428               	;
 429               	; (Julius Luukko/2003-02-14): Changed the name of vector to SIG_OVERFLOW0. In order to the correspo
 430               	; interrupt vector to be set to point to SIG_OVERFLOW0, one has to also #include <avr/io.h> in this
 431               	; Note that no error message or warning will be given, if the include is not present, the interupt 
 432               	; won't get vectored.
 433               	;
 434               	;**************************************************************************************************
 435               	.global	SIG_OVERFLOW0
 436               	SIG_OVERFLOW0:
 437:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm **** OSTickISR:      PUSHRS                              ; Save all registers
 437               	> 
 437 018c 0F92      	> push r0
 437 018e 1F92      	> push r1
 437 0190 2F92      	> push r2
 437 0192 3F92      	> push r3
 437 0194 4F92      	> push r4
 437 0196 5F92      	> push r5
 437 0198 6F92      	> push r6
 437 019a 7F92      	> push r7
 437 019c 8F92      	> push r8
 437 019e 9F92      	> push r9
 437 01a0 AF92      	> push r10
 437 01a2 BF92      	> push r11
 437 01a4 CF92      	> push r12
 437 01a6 DF92      	> push r13
 437 01a8 EF92      	> push r14
 437 01aa FF92      	> push r15
 437 01ac 0F93      	> push r16
 437 01ae 1F93      	> push r17
 437 01b0 2F93      	> push r18
 437 01b2 3F93      	> push r19
 437 01b4 4F93      	> push r20
 437 01b6 5F93      	> push r21
 437 01b8 6F93      	> push r22
 437 01ba 7F93      	> push r23
 437 01bc 8F93      	> push r24
 437 01be 9F93      	> push r25
 437 01c0 AF93      	> push r26
 437 01c2 BF93      	> push r27
 437 01c4 CF93      	> push r28
 437 01c6 DF93      	> push r29
 437 01c8 EF93      	> push r30
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 22


 437 01ca FF93      	> push r31
 437               	> 
 437               	> 
 437               	> 
 437               	> 
 438:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 PUSHSREGISR                         ; Save SREG with I bit set!
 438               	> 
 438 01cc 0FB7      	> in r16,((((0x3F)+0x20))-0x20)
 438 01ce 0068      	> sbr r16,0x80
 438 01d0 0F93      	> push r16
 438               	> 
 439               	
 440:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R16,OSIntNesting            ; Notify uC/OS-II of ISR
 441:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 inc     R16                         ;
 442:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sts     OSIntNesting,R16            ;
 443               	                
 444               	;**************************************************************************************************
 445               	; You should disable the lines between #if 1 and #endif if you use uC/OS-II version 2.51 or below!
 446               	; (Unfortunately OS_VERSION is not defined here (how to do it elegantly? On possibility would be to
 447               	;  code this ISR with C in os_cpu_c.c or use inline assembler in os_cpu_c.c)
 448               	;**************************************************************************************************
 449               	#if 1
 450:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 cpi     R16,0x01
 451:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 brne    _not_first_int
 452               	
 453:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 in      R28,_SFR_IO_ADDR(SPL)       ; Z = SP
 454:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 in      R29,_SFR_IO_ADDR(SPH)
 455:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R30,OSTCBCur                ; Z = OSTCBCur->OSTCBStkPtr
 456:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 lds     R31,OSTCBCur+1              ;
 457:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 st      Z+,R28                      ; Save Y pointer
 458:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 st      Z+,R29                      ;
 459               	_not_first_int:
 460               	#endif
 461:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ldi     R16,256-(CPU_CLOCK_HZ/OS_TICKS_PER_SEC/1024)   
 462               	                                                    ; Reload timer to overflow at a rate of OS_TICK
 463:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 out     _SFR_IO_ADDR(TCNT0),R16     ; at a prescaler of 1024 and CPU_CLOCK_HZ AVR c
 464               		
 465:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ldi     R31,0                       ; R1 must be zero in C
 466:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 mov     R1,R31                      ; thus it is cleard before calling C functions
 467               	        
 468:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 sei                                 ; Enable interrupts
 469               	                
 470               	#if FLASHEND >= 0x2000
 471:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 call    OSTimeTick                  ; Call uC/OS-IIs tick updating function
 472               	#else
 473               	                rcall   OSTimeTick                  ; Call uC/OS-IIs tick updating function
 474               	#endif
 475:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 nop
 476               	#if FLASHEND >= 0x2000
 477:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 call    OSIntExit                   ; Notify uC/OS-II about end of ISR
 478               	#else
 479               	                rcall   OSIntExit                   ; Notify uC/OS-II about end of ISR
 480               	#endif
 481               	
 482:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPSREG
 482               	> 
 482 0204 0F91      	> pop r16
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 23


 482 0206 0FBF      	> out ((((0x3F)+0x20))-0x20),r16
 482               	> 
 483:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 POPRS                               ; Restore all registers and status register
 483               	> 
 483               	> 
 483               	> 
 483               	> 
 483               	> 
 483 0208 FF91      	> pop r31
 483 020a EF91      	> pop r30
 483 020c DF91      	> pop r29
 483 020e CF91      	> pop r28
 483 0210 BF91      	> pop r27
 483 0212 AF91      	> pop r26
 483 0214 9F91      	> pop r25
 483 0216 8F91      	> pop r24
 483 0218 7F91      	> pop r23
 483 021a 6F91      	> pop r22
 483 021c 5F91      	> pop r21
 483 021e 4F91      	> pop r20
 483 0220 3F91      	> pop r19
 483 0222 2F91      	> pop r18
 483 0224 1F91      	> pop r17
 483 0226 0F91      	> pop r16
 483 0228 FF90      	> pop r15
 483 022a EF90      	> pop r14
 483 022c DF90      	> pop r13
 483 022e CF90      	> pop r12
 483 0230 BF90      	> pop r11
 483 0232 AF90      	> pop r10
 483 0234 9F90      	> pop r9
 483 0236 8F90      	> pop r8
 483 0238 7F90      	> pop r7
 483 023a 6F90      	> pop r6
 483 023c 5F90      	> pop r5
 483 023e 4F90      	> pop r4
 483 0240 3F90      	> pop r3
 483 0242 2F90      	> pop r2
 483 0244 1F90      	> pop r1
 483 0246 0F90      	> pop r0
 483               	> 
 484:uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm ****                 ret                                 ; Note: RET instead of RETI
GAS LISTING C:\Users\RAGHAV~1\AppData\Local\Temp/ccyUokjj.s 			page 24


DEFINED SYMBOLS
uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm:254    .text:00000000 OSStartHighRdy
uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm:306    .text:00000064 OSCtxSw
uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm:377    .text:00000122 OSIntCtxSw
uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm:437    .text:0000018c OSTickISR
uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm:436    .text:0000018c __vector_11
uCOS-II/Ports/AVR/Atmega32/os_cpu_a.asm:459    .text:000001f0 _not_first_int

UNDEFINED SYMBOLS
OSTaskSwHook
OSRunning
OSTCBHighRdy
OSTCBCur
OSPrioHighRdy
OSPrioCur
OSIntNesting
OSTimeTick
OSIntExit
